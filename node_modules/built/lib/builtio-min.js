function Built(){var e=this;var t={Base:"https://api.built.io/v1",register:"/application/users/",login:"/application/users/login/",logout:"/application/users/logout/",user:"/application/users/",getUserInfo:"/application/users/current/",classes:"/classes/",objects:"/objects/",upload:"/uploads/",version:"/v1/",host:"api.built.io",proto:"https://",forgotPassword:"/application/users/forgot_password/request_password_reset/",role:"/built_io_application_user_role/objects/",notification:"/push/",extensionURL:"/functions/",genAuth:"generate_authtoken"},n="only_network",r=null,s,o,u,a=false;if(isNode){o=require("request");u=require("fs")}else{}e.VERSION="1.3.2";if(typeof console==="undefined"){console={log:function(){}}}if(typeof JSON==="undefined"){JSON={};JSON.parse=JSON.stringify=function(){throw new Error("JSON parse and stringify is not supported in this platform ,"+" include json2 ( https://github.com/douglascrockford/JSON-js ) in your project")}}var f={},l={},c=true,h=function(){return Math.floor(Math.random()*(new Date).getTime())},p=function(e){return e.replace(/[\/]+/g,"/").replace(":/","://").replace(/[\/]$/,"")},d=function(e){for(var t in e){return false}return true},v=function(t,n){var r=this;var i;if(t&&Object.prototype.hasOwnProperty.call(t,"constructor")){i=t.constructor}else{i=function(){return r.apply(this,arguments)}}e.Util.extend(i,r,n);var s=function(){this.constructor=i};s.prototype=r.prototype;i.prototype=new s;if(t)e.Util.extend(i.prototype,t);i.__super__=r.prototype;return i},m=function(t){var n=new e.Promise;var r={};n.onSuccess=n.success;n.onError=n.error;n.onAlways=n.always;if(e.Util.dataType(t)=="object"){r=e.Util.clone(t);n.onSuccess(r.onSuccess);n.onSuccess(r.success);n.onError(r.onError);n.onError(r.error);n.onAlways(r.onAlways);n.onAlways(r.always)}r.onSuccess=r.success=n.resolve;r.onError=r.error=n.reject;n.__options=r;return n};(function(e){var n=e;n.initialize=function(e,t){f={},l={},r=null;if(typeof e==="object"){if(e&&e.application_api_key&&e.application_uid){f["application_api_key"]=e.application_api_key;f["application_uid"]=e.application_uid}}else{if(typeof e=="string"){f["application_api_key"]=e}if(typeof t=="string"){f["application_uid"]=t}}n.User.setHeader(f);return n};n.init=n.initialize;n.setTenant=function(e){if(typeof e=="string"){n.setHeaders("tenant_uid",e)}return n};n.removeTenant=function(){return n.removeHeader("tenant_uid")};n.removeHeader=function(e){if(typeof e==="string"&&e!==""&&e!=="authtoken"&&f[e]){delete f[e];n.User.setHeader(f)}return n};n.setHeaders=function(e,t){if(n.Util.dataType(e)=="object"){var r=n.Util.clone(e);f=n.Util.mix(f,r)}else if(typeof e=="string"&&typeof t=="string"){f[e]=t}n.User.setHeader(f);return n};n.setHeader=n.setHeaders;n.getHeaders=function(){return n.Util.clone(f)};n.setURL=function(e,r){var i=/https?/ig;var s=/https?:\/\//ig;r=r||"https";if(typeof r=="string"){r=r.match(i);if(r){t.proto=r[0]+"://"}}if(typeof e=="string"){r=e.match(s);if(r){t.proto=r[0]}t.host=e.replace(s,"")}t.Base=p(t.proto+t.host+t.version);return n};n.addQueryString=function(e,t){if(typeof e=="string"&&typeof t=="string"){if(t==""&&l[e]){delete l[e];return}l[e]=t}return n};n.fallbackForCORS=function(e){if(n.Util.dataType(e)=="boolean"){c=e}return n};n.setMasterKey=function(e){if(e&&typeof e==="string"&&e.length){n.setHeaders("master_key",e)}return n};n.removeMastkerKey=function(){return n.removeHeader("master_key")}})(e);(function(e){var t=e;t.Util={};t.Util.parallel=function(e,t){if(this.dataType(e)=="object"){var n=this;var r=function(){var r=0,i=0,s=null,o={};for(var u in e){r+=1}var a=function(e){var n=e,u=function(){return function(e,u){if(e!=null){if(s==null&&typeof t=="function"){t(e,null);s=true}e=s}else{i+=1;o[n]=u;if(i>=r&&typeof t=="function"){t(s,o)}}}};return new u};for(var u in e){e[u](a(u))}return n};return new r}else{throw new Error("object parameter required for parallel tasks")}return this};t.Util.param=function(e,t){var n=[],r,i=/%20/g,s=function(e,r){r=r==null?"":r;if(t){n[n.length]=e+"="+r}else{n[n.length]=encodeURIComponent(e)+"="+encodeURIComponent(r)}};if(this.dataType(e)=="object"){for(var r in e){this.__buildParams__(r,e[r],s)}}else{var o=JSON.parse(e);for(var r in o){this.__buildParams__(r,o[r],s)}}return n.join("&").replace(i,"+")};t.Util.__buildParams__=function(e,t,n){var r=/\[\]$/;if(this.dataType(t)=="array"){for(var i=0;i<t.length;i++){if(r.test(e)){n(e,t[i])}else{this.__buildParams__(e+"["+(isNaN(i)?i:"")+"]",t[i],n)}}}else if(this.dataType(t)=="object"){for(name in t){this.__buildParams__(e+"["+name+"]",t[name],n)}}else{n(e,t)}};t.Util.dataType=function(e){if(e===null){return"null"}else if(e&&(e.nodeType===1||e.nodeType===9)){return"element"}var t=Object.prototype.toString.call(e).match(/\[object (.*?)\]/)[1].toLowerCase();if(t==="number"){if(isNaN(e)){return"nan"}if(!isFinite(e)){return"infinity"}}return t};t.Util.mix=function(e,t){if(typeof e=="object"&&typeof t=="object"){var n=this.clone(e);for(var r in t){n[r]=t[r]}return n}};t.Util.clone=function(e){var t={};for(var n in e){t[n]=e[n]}return t};t.Util.each=function(e,t,n){var r=Array.prototype.forEach,i={};if(e==null)return;if(r&&e.forEach===r){e.forEach(t,n)}else if(e.length===+e.length){for(var s=0,o=e.length;s<o;s++){if(t.call(n,e[s],s,e)===i)return}}else{for(var u in e){if(e[u]){if(t.call(n,e[u],u,e)===i)return}}}};t.Util.extend=function(e){var t=Array.prototype.slice;this.each(t.call(arguments,1),function(t){if(t){for(var n in t){e[n]=t[n]}}});return e};t.Util.deparam=function(e,t){try{var n={},r={"true":!0,"false":!1,"null":null};var i=e.replace(/\+/g," ").split("&");var s=i.length;for(var o=0;o<s;o++){var u=i[o].split("="),a=decodeURIComponent(u[0]),f,l=n,c=0,h=a.split("]["),p=h.length-1;if(/\[/.test(h[0])&&/\]$/.test(h[p])){h[p]=h[p].replace(/\]$/,"");h=h.shift().split("[").concat(h);p=h.length-1}else{p=0}if(u.length===2){f=decodeURIComponent(u[1]);if(t){f=f&&!isNaN(f)?+f:f==="undefined"?undefined:r[f]!==undefined?r[f]:f}if(p){for(;c<=p;c++){a=h[c]===""?l.length:h[c];l=l[a]=c<p?l[a]||(h[c+1]&&isNaN(h[c+1])?{}:[]):f}}else{if(this.dataType(n[a])=="array"){n[a].push(f)}else if(n[a]!==undefined){n[a]=[n[a],f]}else{n[a]=f}}}else if(a){n[a]=t?undefined:""}}return n}catch(d){throw d}};t.Util.random=function(){return Math.floor(Math.random()*(new Date).getTime())};t.Util.trim=function(e){return e.replace(/^\s+|\s+$/g,"")}})(e);(function(e){var t=e;t.Events={__makeSure:function(e){if(!this.__listeners||typeof this.__listeners!=="object"){this.__listeners={}}if(!this.__listeners[e]||typeof this.__listeners[e]!=="object"){this.__listeners[e]=[]}return true},on:function(e,n,r){var i=this;if(typeof e=="string"&&e!=""&&typeof n=="function"){e=e.split(",");t.Util.each(e,function(e){e=t.Util.trim(e);if(e!=""){i.__makeSure(e);r=r||false;i.__listeners[e].push({callback:n,context:r,id:t.Util.random()})}})}return this},off:function(e,n){var r=this;if(arguments.length==0){r.__listeners={};return r}e=e.split(",");t.Util.each(e,function(e){e=t.Util.trim(e);var i=r.__listeners[e];if(e&&i&&i.length){if(typeof n==="undefined"){delete r.__listeners[e]}else{for(var s=0;s<i.length;s++){if(n===i[s].callback){r.__listeners[e].splice(s,1)}}}}});return this},trigger:function(e){var n=this;if(!n.__listeners||typeof n.__listeners!=="object"){return n}e=e.split(",");t.Util.each(e,function(e){e=t.Util.trim(e);var r=n.__listeners[e];if(e&&r){var i=Array.prototype.slice.call(arguments,1);t.Util.each(r,function(e){if(typeof e.callback=="function"){var t=e.context||n;e.callback.apply(t,i)}})}});return this},inherit:function(e){e=e||{};var n=t.Util.clone(this);try{delete n.__listeners}catch(r){}if(Object.prototype.hasOwnProperty.call(e,"prototype")){return v.call(e,n)}else{return t.Util.mix(e,n)}},listenTo:function(e,t){var n=this;if(e&&typeof e=="object"&&typeof e.on=="function"&&t!=""){e.on(t,function(){var e=Array.prototype.slice.call(arguments,0);e.unshift(t);n.trigger.apply(n,e)})}return n}};t.Events.bind=t.Events.on;t.Events.unbind=t.Events.off})(e);(function(e){var n=e;n.___fileInternals__=function(){var e={};this.add=function(t,n,r){if(t){e={file:t,attributes:n,options:r}}return this};this.upload=function(n){n=n||{};if(g.VALIDATE(f,n.onError||n.error)){return{}}var r=this;if(d(e)==true){throw new Error("no file found")}var s=false;if(typeof e["options"]=="object"&&e["options"]["id"]){s=true}var o=e;var u=p(t.Base+t.upload+(s?o["options"]["id"]:"")),a=o["attributes"]||{},l=o["options"]||{},c=o["file"];return i(u,f,c,n,a,l)};var r=function(){var n={};for(var r in e){var s=false;if(typeof e[r]["options"]=="object"&&e[r]["options"]["id"]){s=true}n[r]=function(e,n){return function(r){var s=e["file"];var o={onSuccess:function(e,t){r(null,e)},onError:function(e,t){r(e,e)}};var u=p(t.Base+t.upload+(n?e["options"]["id"]:"")),a=e["attributes"]||{},l=e["options"]||{};i(u,f,s,o,a,l)}}(e[r],s)}return n};var i=function(e,n,r,i,o,u){if(t.host==""||typeof t.host!=="string"||t.host.length<=0){throw new Error("set host for built.io server. eg: Built.setURL('api.built.io')")}i=i||{};var a=function(e,t){try{e=JSON.parse(e)}catch(n){}if(typeof e=="object"&&typeof e.notice!=="undefined"){if(typeof i.onSuccess=="function"){i.onSuccess(e.upload,t)}}else{if(typeof i.onError=="function"){i.onError(e,t)}}};if(isNode){return c(e,n,r,a,o,u)}return s(e,n,r,a,o,u)};var s=function(e,r,i,s,o,u){if(t.host==""||typeof t.host!=="string"||t.host.length<=0){throw new Error("set host for built.io server. eg: Built.setURL('built.io')");return}r=r||{};o=o||{};if(typeof window==="object"&&typeof window.FormData!=="undefined"){var f=new XMLHttpRequest,l;if(i instanceof FormData){l=i}else if(n.Util.dataType(i)=="element"){l=new FormData;if(i.getAttribute("type")=="file"){l.append("upload[upload]",i.files[0])}else{s({error_message:"input file element required"},null);throw new Error("input file element required")}}else if(typeof File!=="undefined"&&i instanceof File){l=new FormData;l.append("upload[upload]",i)}else{throw new Error("HTML input file element or FormData or File required")}var c={upload:{}};for(var h in o){c.upload[h]=o[h]}l.append("PARAM",JSON.stringify(c));if(u&&u.id){l.append("_method","put")}f.open("POST",e,true);if(n.Util.dataType(r)=="object"){for(var p in r){f.setRequestHeader(p,r[p])}}if(typeof s=="function"){f.onreadystatechange=function(t){if(f.readyState==4){if(f.status!=0){s(f.responseText,f)}else if(f.__aborted__){s({error_message:"request aborted"},f)}else{a(e,r,i,s,o,u)}n.Events.trigger("upload:end")}}}if(typeof u.onprogress=="function"&&typeof f.upload=="object"){f.upload.onprogress=u.onprogress}f.ontimeout=f.onerror=function(e){var t={error_message:"error occured",http:f,event:e};s(t,f);n.Events.trigger("upload:end");s=function(){}};f.__aborted__=false;f.send(l);n.Events.trigger("upload:start");return{_XHR:true,abort:function(){n.Events.trigger("upload:end");f.__aborted__=true;f.abort()}}}else{return a(e,r,i,s,o,u)}};var a=function(e,t,r,i,s,o){if(typeof r[0]!=="undefined"){r=r[0]}if(n.Util.dataType(r)=="element"){if(r.getAttribute("type")=="file"){var u=r.cloneNode();r.style.display="none";r.parentNode.insertBefore(u,r);var a="POST";var f=h().toString();if(typeof n.cbTray!="object"){n.cbTray={}}n.cbTray[f]=i;var c=T(e,t,r,a,f);var p=l(e,t,r,a,f,s,o);p.submit();n.Events.trigger("upload:start");return function(e){return{_XHR:false,abort:function(){n.Events.trigger("upload:end");if(typeof n.cbTray[e]==="function"){n.cbTray[e]=function(){try{delete n.cbTray[e]}catch(t){}};try{var t=document.getElementById("frame_"+e);t.parentNode.removeChild(t)}catch(r){}try{var i=document.getElementById("form_"+e);i.parentNode.removeChild(i)}catch(r){}}}}}(f)}else{i({error_message:"input file element required"},null);throw new Error("input file element required")}}else{i({error_message:"HTML input file element or FormData required for upload"},null);throw new Error("HTML input file element or FormData required for upload")}};var l=function(e,n,r,i,s,o,u){if(t.host==""||typeof t.host!=="string"||t.host.length<=0){throw new Error("set host for built.io server. eg: Built.setURL('built.io')");return}i=i.toUpperCase();var a=document.createElement("form");a.setAttribute("id","form_"+s);a.setAttribute("target","frame_"+s);a.setAttribute("method","post");a.setAttribute("height","0");a.setAttribute("width","0");a.setAttribute("style","display:none");a.setAttribute("enctype","multipart/form-data");a.setAttribute("encoding","multipart/form-data");e=p(e)+".postmessage";a.setAttribute("action",e);for(var f in n){try{a.appendChild(k(f.toString().toUpperCase(),n[f]))}catch(l){}}r.setAttribute("name","upload[upload]");a.appendChild(r);var c={upload:{}};for(var h in o){c.upload[h]=o[h]}a.appendChild(k("PARAM",JSON.stringify(c)));if(typeof u=="object"&&u.id){a.appendChild(k("_method","put"))}a.appendChild(k("postmessage_payload",s));a.appendChild(k("host",document.location.origin?document.location.origin:document.location.protocol+"//"+document.location.host));document.body.appendChild(a);return a};var c=function(e,t,r,i,s,a){t=t||{};s=s||{};var f=o.post(e,function(e,t,r){n.Events.trigger("upload:end");if(e){return i(e,t)}i(r,t)});n.Events.trigger("upload:start");var l=f.form();var c={upload:{}};for(var h in s){c.upload[h]=s[h]}l.append("PARAM",JSON.stringify(c));if(a&&a.id){l.append("_method","put")}for(var p in t){l.append(p.toString().toUpperCase(),t[p])}if(r.indexOf("://")>=0){l.append("upload[upload]",o(r))}else{l.append("upload[upload]",u.createReadStream(r))}return{_XHR:true,abort:function(){n.Events.trigger("upload:end");f.abort()}}}}})(e);(function(e){var t=e;t.File=function(e){var n;var r={};var i={};var s=null;if(typeof e=="string"){n=e;r.uid=e}else if(t.Util.dataType(e)=="object"&&typeof e["uid"]=="string"){r=e;n=e.uid}this.setFile=function(e){if(e){if(isNode){if(e.indexOf("://")>=0){i["upload"]=e;return this}else{if(u.existsSync(e)){if(u.statSync(e).isFile()){i["upload"]=e;return this}}throw new Error("invalid file path: "+e)}}else{if(typeof e[0]!=="undefined"){e=e[0]}if(t.Util.dataType(e)=="element"||typeof FormData!=="undefined"&&e instanceof FormData||typeof File!=="undefined"&&e instanceof File){i["upload"]=e}else{throw new Error("The parameter is not valid or not supported by the platform. Please pass an html input elment.")}}}else{throw new Error("file parameter required")}return this};this.addFile=this.setFile;this.setTags=function(e){var n=e;if(t.Util.dataType(n)==="array"){n=n.join(",")}if(n.indexOf(" ")>=0){n=n.split(" ").join(",")}i["tags"]=n;return this};this.setACL=function(e){if(typeof e=="object"&&typeof e.toJSON=="function"){var t=e.toJSON();i["ACL"]=t}else if(typeof e==="boolean"){i["ACL"]={disable:e}}return this};this.destroy=function(e){if(n){e=e||{};var t=this,s={},o=m(e);e=o.__options;var u=function(t,s){try{t=JSON.parse(t)}catch(o){}if(typeof t=="object"&&typeof t.notice!=="undefined"){n=null;r={};i={};if(typeof e.onSuccess=="function"){e.onSuccess(t,s)}}else{if(typeof e.onError=="function"){e.onError(t,s)}}};s.uid=n;var a=g.UPLOAD.destroy(f,{},u,s);o._XHR=a._XHR;o.abort=a.abort;return o}else{throw new Error("set upload uid")}};this.fetch=function(e){if(n){e=e||{};var t=this,s=m(e);e=s.__options;var o=function(t,s){try{t=JSON.parse(t)}catch(o){}if(typeof t=="object"&&typeof t.upload!=="undefined"){r=t.upload;n=r.uid;i={};if(typeof e.onSuccess=="function"){e.onSuccess(t,s)}}else{if(typeof e.onError=="function"){e.onError(t,s)}}};var u={uid:n};var a=g.UPLOAD.fetch(f,{},o,u);s._XHR=a._XHR;s.abort=a.abort;return s}else{throw new Error("set upload uid")}};this.get=function(e){if(typeof e=="string"){return r[e]}};this.setUid=function(e){if(typeof e=="string"){n=e;attribute.uid=e}return this};this.save=function(e){e=e||{};if(i["upload"]){var o=new t.___fileInternals__;var u={};var a={};var f=e.onSuccess;e.onSuccess=function(e,t){r=e;n=r.uid;i={};if(typeof f=="function"){f(e,t)}};var l=m(e);e=l.__options;if(i["tags"]){u.tags=i["tags"]}if(i["ACL"]){u.ACL=i["ACL"]}if(n){a["id"]=n}if(typeof s=="function"){a["onprogress"]=s}o.add(i["upload"],u,a);var c=o.upload(e);l._XHR=c._XHR;l.abort=c.abort;return l}else{throw new Error("no upload found")}};this.toJSON=function(){return t.Util.clone(r)};this.onProgress=function(e){if(typeof e=="function"){s=e}return this}};t.FileObject=t.File})(e);(function(e){e.User=function(){function o(){if(t instanceof e.User){return i}else{return f}}function u(){if(t instanceof e.User){return s}else{return r}}function a(n){if(t instanceof e.User){s=n}else{r=n}return c()}function l(t){if(t){return e.Util.mix(o(),t)}return e.Util.clone(o())}function c(){if(t instanceof e.User){return t}else{return n.User}}var t=this;var n={User:t};var i=e.Util.clone(f);var s=e.Util.clone(r);n.User.getInfo=function(t){return e.Util.clone(s)};n.User.setAuthToken=function(e){if(e&&typeof e==="string"){o().authtoken=e}return c()};n.User.removeAuthToken=function(){if(o().authtoken){delete o().authtoken}return c()};n.User.setHeader=function(t,n){if(t&&n){if(typeof t==="string"&&typeof n==="string"){o()[t]=n}}else if(t&&e.Util.dataType(t)==="object"){for(var r in t){o()[r]=t[r]}}return c()};n.User.setHeaders=n.User.setHeader;n.User.getHeaders=function(){return e.Util.clone(o())};n.User.login=function(t,i,u){u=u||{};var a=this;if(typeof t!=="string"||typeof i!=="string"){return u.onError({error_message:"Email and Password required"},null)}var f=m(u);u=f.__options;var c=function(t,i){try{t=JSON.parse(t)}catch(a){}if(typeof t==="object"&&t.application_user){r=t.application_user;s=t.application_user;o()["authtoken"]=t.application_user.authtoken;n.User.loginType="built";e.Events.trigger("user:login",t,"built");if(typeof u.onSuccess=="function"){u.onSuccess(t,i)}}else{if(typeof u.onError=="function"){u.onError(t,i)}}};var h={application_user:{email:t,password:i}};var p=g.USER.login(l(),h,c,{});f._XHR=p._XHR;f.abort=p.abort;return f};n.User.update=function(e,t){var n=this;t=t||{};e=e||{};var r=m(t);var i=l();t=r.__options;if(s&&typeof s==="object"&&s.uid&&i.authtoken&&i.application_api_key&&i.application_uid){var o=function(e,n){try{e=JSON.parse(e)}catch(r){}if(typeof e=="object"&&e.notice){a(e.application_user);if(typeof t.onSuccess=="function"){t.onSuccess(e,n)}}else{if(typeof t.onError=="function"){t.onError(e,n)}}};var u=g.USER.update(l(),e,o,s);r._XHR=u._XHR;r.abort=u.abort;return r}else{if(typeof t.onError=="function"){return t.onError({error_message:"Parameter missing"},null)}}};n.User.loginWithGoogle=function(t,r){if(typeof t==="string"){r=r||{};var i={onError:r.onError,onAlways:r.onAlways,onSuccess:function(t,i){n.User.__setUser__(t);n.User.loginType="google";e.Events.trigger("user:login",t,"google");if(typeof r.onSuccess==="function"){r.onSuccess(t,i)}}};var s=m(i);i=s.__options;var o=n.User.register({auth_data:{google:{access_token:t}}},i);s._XHR=o._XHR;s.abort=o.abort;return s}else{throw new Error("Google access token required for login")}return c()};n.User.loginWithTibbr=function(t,r,i){if(typeof t=="string"&&typeof r=="string"){i=i||{};var s={onError:i.onError,onAlways:i.onAlways,onSuccess:function(t,r){n.User.__setUser__(t);n.User.loginType="tibbr";e.Events.trigger("user:login",t,"tibbr");if(typeof i.onSuccess=="function"){i.onSuccess(t,r)}}};var o=m(s);s=o.__options;var u=n.User.register({auth_data:{tibbr:{access_token:t,host:r}}},s);o._XHR=u._XHR;o.abort=u.abort;return o}else{throw new Error("tibbr access token and host required for login")}return c()};n.User.loginWithFacebook=function(t,r){if(typeof t=="string"){r=r||{};var i={onError:r.onError,onAlways:r.onAlways,onSuccess:function(t,i){n.User.__setUser__(t);n.User.loginType="facebook";e.Events.trigger("user:login",t,"facebook");if(typeof r.onSuccess=="function"){r.onSuccess(t,i)}}};var s=m(i);i=s.__options;var o=n.User.register({auth_data:{facebook:{access_token:t}}},i);s._XHR=o._XHR;s.abort=o.abort;return s}else{throw new Error("Facebook access token required for login")}return c()};n.User.loginWithTwitter=function(t,r){if(typeof t=="object"&&t.consumer_key&&t.consumer_secret&&t.token&&t.token_secret){r=r||{};var i={onError:r.onError,onAlways:r.onAlways,onSuccess:function(t,i){n.User.__setUser__(t);n.User.loginType="twitter";e.Events.trigger("user:login",t,"twitter");if(typeof r.onSuccess=="function"){r.onSuccess(t,i)}}};var s=m(i);i=s.__options;var o=n.User.register({auth_data:{twitter:{consumer_key:t.consumer_key,consumer_secret:t.consumer_secret,token:t.token,token_secret:t.token_secret}}},i);s._XHR=o._XHR;s.abort=o.abort;return s}else{throw new Error("Twitter Consumer key, Consumer Secret, Token, Token Secret required for login")}return c()};n.User.saveSession=function(){var t=l();if(typeof localStorage==="undefined"){return this}if(typeof s==="object"&&typeof localStorage!=="undefined"&&t["application_api_key"]){if(t.authtoken){s.authtoken=t.authtoken}localStorage.setItem(t["application_api_key"],JSON.stringify(s));e.Events.trigger("user:save-session",s)}return c()};n.User.setCurrentUser=function(t){if(typeof t==="object"&&t!==null&&t.authtoken){var n=this;a(t);if(t.authtoken){o().authtoken=u().authtoken}else if(o().authtoken){u().authtoken=o().authtoken}e.Events.trigger("user:set-current-user",s)}return c()};n.User.getSession=function(){var e=l();if(typeof e["application_api_key"]==="undefined"){throw new Error("initialize built.io sdk using Built.init(apiKey, appUid)")}try{if(localStorage.getItem(e["application_api_key"])){return JSON.parse(localStorage.getItem(e["application_api_key"]))}}catch(t){}return null};n.User.clearSession=function(){var t=this;r=null;s=null;var i=l();if(!(t instanceof e.User)){try{delete f["authtoken"]}catch(o){}}try{localStorage.removeItem(i["application_api_key"])}catch(o){}n.User.loginType=null;e.Events.trigger("user:clear-session");return c()};n.User.logout=function(t){t=t||{};if(s===null||typeof s!=="object"||typeof s.authtoken==="undefined"){throw new Error("no user found")}var r=m(t);t=r.__options;var i=function(r,i){try{r=JSON.parse(r)}catch(s){}if(r&&typeof r==="object"&&typeof r.notice!=="undefined"){n.User.clearSession();e.Events.trigger("user:logout");if(typeof t.onSuccess=="function"){t.onSuccess(r,i)}}else{if(typeof t.onError=="function"){t.onError(r,i)}}};var o=g.USER.logout(l(),{},i,{});r._XHR=o._XHR;r.abort=o.abort;return r};n.User.register=function(t,n){t=t||{};n=n||{};if((typeof t.email==="undefined"||typeof t.password==="undefined"||typeof t.password_confirmation==="undefined")&&typeof t.auth_data==="undefined"){throw new Error("missing required parameters. provide email, password, password_confirmation or auth_data");return}var r=m(n);n=r.__options;var i=function(t,r){try{t=JSON.parse(t)}catch(i){}if(t&&typeof t=="object"&&typeof t.notice!=="undefined"){e.Events.trigger("user:register",t);if(typeof n.onSuccess=="function"){n.onSuccess(t,r)}}else{if(typeof n.onError=="function"){n.onError(t,r)}}},s={application_user:t};var o=g.USER.register(l(),s,i,{});r._XHR=o._XHR;r.abort=o.abort;return r};n.User.activate=function(t,n,r){if(typeof t=="string"&&typeof n=="string"){r=r={};var i={userId:t,activationToken:n};var s=m(r);r=s.__options;var o=function(t,n){try{t=JSON.parse(t)}catch(i){}if(t&&typeof t=="object"&&typeof t.notice!=="undefined"){e.Events.trigger("user:activate",t);if(typeof r.onSuccess=="function"){r.onSuccess(t,n)}}else{if(typeof r.onError=="function"){r.onError(t,n)}}};var u=g.USER.activate(l(),{},o,i);s._XHR=u._XHR;s.abort=u.abort;return s}else{throw new Error("user uid and activation token required")}};n.User.deactivate=function(t,n){var r=this;var i=l();if(typeof i["authtoken"]==="undefined"){throw new Error("authenticated session required")}else if(typeof t!="string"){throw new Error("user uid required")}n=n||{};var s=m(n);n=s.__options;var o=function(t,i){try{t=JSON.parse(t)}catch(s){}if(t&&typeof t==="object"&&typeof t.notice!=="undefined"){a(null);e.Events.trigger("user:deactivate",t);if(!(r instanceof e.User)){if(f["authtoken"]){delete f["authtoken"]}}if(typeof n.onSuccess==="function"){n.onSuccess(t,i)}}else{if(typeof n.onError==="function"){n.onError(t,i)}}};var u=g.USER.deactivate(l(),{},o,{userId:t});s._XHR=u._XHR;s.abort=u.abort;return s};n.User.isAuthenticated=function(){var e=l();if(e["authtoken"]){return true}return false};n.User.getCurrentUser=function(){return e.Util.clone(s||{})};n.User.refreshUserInfo=function(e){var t=this;e=e||{};var n=l();if(typeof n["authtoken"]==="undefined"){throw new Error("no authtoken found");return}var r=m(e);e=r.__options;var i=function(t,r){try{t=JSON.parse(t)}catch(i){}if(typeof t=="object"&&t.application_user){var o=u().authtoken||n["authtoken"];a(t);u().authtoken=o;if(typeof e.onSuccess=="function"){e.onSuccess(s,r)}}else{if(typeof e.onError=="function"){e.onError(t,r)}}};var o=g.USER.fetchUserInfo(l(),{},i,{});r._XHR=o._XHR;r.abort=o.abort;return r};n.User.forgotPassword=function(e,t){t=t||{};if(typeof e!=="string"){throw new Error("email id required");return}var n=m(t);t=n.__options;var r=function(e,n){try{e=JSON.parse(e)}catch(r){}if(e&&typeof e==="object"&&typeof e.notice!=="undefined"){if(typeof t.onSuccess==="function"){t.onSuccess(e,n)}}else{if(typeof t.onError==="function"){t.onError(e,n)}}};var i={application_user:{email:e}};var s=g.USER.forgotPassword(l(),i,r,{});n._XHR=s._XHR;n.abort=s.abort;return n};n.User.requestResetPassword=n.User.forgotPassword;n.User.fetchUserByAuthtoken=function(t){var n=l();var r=new e.Promise,i={application_api_key:n["application_api_key"],application_uid:n["application_uid"],authtoken:t};var s=function(e,t){try{e=JSON.parse(e)}catch(n){}if(typeof e==="object"&&e.application_user){e=e.application_user;r.resolve(e,t)}else{r.reject(e,t)}};var o=g.USER.fetchUserInfo(l(i),{},s,{});r._XHR=o._XHR;r.abort=o.abort;return r};var h=function(e,t){var n=m(t);t=n.__options;var r=function(e,n){try{e=JSON.parse(e)}catch(r){}if(typeof e=="object"&&e.uid){if(typeof t.onSuccess=="function"){t.onSuccess(e,n)}}else{if(typeof t.onError=="function"){t.onError(e,n)}}};var i=g.USER.fetchUidByEmail(l(),e,r);n._XHR=i._XHR;n.abort=i.abort;return n};n.User.fetchUserUidByEmail=function(e,t){if(typeof e=="string"){var n={application_user:{email:e}};t=t||{};return h(n,t)}else{throw new Error("email id required")}};n.User.fetchUserUidByGoogleEmail=function(e,t){if(typeof e=="string"){var n={application_user:{auth_data:{google:{email:e}}}};t=t||{};return h(n,t)}else{throw new Error("Google email id required")}};n.User.fetchUserUidByFacebookUserId=function(e,t){if(typeof e=="string"){var n={application_user:{auth_data:{facebook:{user_id:e}}}};t=t||{};return h(n,t)}else{throw new Error("facebook user id required")}};n.User.fetchUserUidByTibbrUserId=function(e,t,n){if(typeof e==="string"&&typeof t==="string"){var r={application_user:{auth_data:{tibbr:{user_id:e,host:t}}}};n=n||{};return h(r,n)}else{throw new Error("tibbr user id and host required")}return this};n.User.getUserQuery=function(){return new e.Query("built_io_application_user")};n.User.generateAuthtoken=function(t,n,r){n=n||false;r=r||{};if(!t instanceof e.Query){throw error("Built.Query object required for filtering user")}var i=m();var s=function(e,t){try{e=JSON.parse(e)}catch(n){}if(typeof e==="object"&&e.application_user){i.resolve(e.application_user,t)}else{i.reject(e,t)}};var o={insert:n,query:t.toJSON().query,application_user:r};var u=g.USER.generateAuthtoken(o,s);i._XHR=u._XHR;i.abort=u.abort;return i};n.User.__setUser__=function(e){var t=this;try{e=JSON.parse(e)}catch(n){}var r=l();if(typeof e=="object"&&e.notice&&typeof e.application_user=="object"&&e.application_user.authtoken){a(e.application_user);r["authtoken"]=e.application_user.authtoken;return true}return false};n.User.loginType=null};var t=new e.User;for(var n in t){e.User[n]=t[n]}})(e);(function(e){var t=e;t.Delta=function(e){if(typeof e!="string"){throw new Error("class uid required for delta object")}var n={delta:{}};var r=e;this.createdAt=function(e){if(typeof r!="string"){throw new Error("class uid required")}if(typeof e!="string"){throw new Error("time param required to query delta objects")}n.delta["created_at"]=e;return this};this.deletedAt=function(e){if(typeof r!="string"){throw new Error("class uid required")}if(typeof e!="string"){throw new Error("time param required to query delta objects")}n.delta["deleted_at"]=e;return this};this.updatedAt=function(e){if(typeof r!="string"){throw new Error("class uid required")}if(typeof e!="string"){throw new Error("time param required to query delta objects")}n.delta["updated_at"]=e;return this};this.allDeltaAt=function(e){if(typeof r!="string"){throw new Error("class uid required")}if(typeof e!="string"){throw new Error("time param required to query delta objects")}n.delta["ALL"]=e;return this};this.exec=function(e){e=e||{};var i=this;if(typeof r!="string"){throw new Error("class uid required")}if(t.Util.dataType(n)!="object"||d(n)==true){throw new Error("no delta query found");return}var s=new t.Query(r);var o={};o.query=n;o.model=false;o.onSuccess=function(t,n){if(e.model===false){if(typeof e.onSuccess=="function"){e.onSuccess(t,n)}}else{if(typeof t.objects.created_at!=="undefined"){t.objects.created_at=s.__toObjectModel__(t.objects.created_at,r)}if(typeof t.objects.updated_at!=="undefined"){t.objects.updated_at=s.__toObjectModel__(t.objects.updated_at,r)}if(typeof t.objects.deleted_at!=="undefined"){t.objects.deleted_at=s.__toObjectModel__(t.objects.deleted_at,r)}if(typeof e.onSuccess=="function"){e.onSuccess(t.objects,n)}}};o.onError=e.onError;o.onAlways=e.onAlways;return s.exec(o)}}})(e);(function(e){var t=e;t.Object=function(e,n,r){function p(e){if(e){return t.Util.mix(t.Util.mix(c,h.headers),e)}return t.Util.mix(c,h.headers)}var i=null,s={},o=null,u={},a={},l={},c=t.Util.clone(f),h={headers:{},info:{}};me=this;if(e){if(this.class_uid&&arguments.length==1){if(typeof e=="string"){n={uid:e}}else{n=e}}else if(typeof e=="string"){this.class_uid=e}}if(typeof n=="string"&&n!==""){n={uid:n}}if(typeof this.class_uid!="string"){throw new Error("class uid required")}if(t.Util.dataType(n)==="object"){s=t.Util.clone(n);if(typeof n.uid==="string"&&n.uid!==""){o=n.uid}}if(!r){a=t.Util.clone(s)}this.initialize=function(){};this._validate=function(){if(typeof this.validate=="function"){return this.validate.apply(this,arguments)}return true};this.setUser=function(e){if(e&&typeof e.getHeaders==="function"){h.headers=e.getHeaders();h.info=e.getInfo()}return me};this.setTags=function(e){var n=e;if(t.Util.dataType(e)==="array"){n=n.join(",")}if(n.indexOf(" ")>=0){n=n.split(" ").join(",")}a["tags"]=n;return this};this.timeless=function(){c["timeless"]=true};this.upsert=function(e){if(t.Util.dataType(e)=="object"){if(typeof l["UPSERT"]==="undefined"){l["UPSERT"]={}}l["UPSERT"]=t.Util.mix(l["UPSERT"],e)}};this.upsertForReference=function(e,n){if(typeof e=="string"&&t.Util.dataType(n)=="object"){if(typeof a[e]!=="object"){a[e]={}}a[e]["UPSERT"]=n}return this};this.increment=function(e,t){if(typeof e=="string"&&e!=""){t=isNaN(t)==true?1:t;this.set(e,{ADD:t})}return this};this.decrement=function(e,t){if(typeof e=="string"&&e!=""){t=isNaN(t)==true?1:t;this.set(e,{SUB:t})}return this};this.multiply=function(e,t){if(typeof e=="string"&&e!=""){t=isNaN(t)==true?1:t;this.set(e,{MUL:t})}return this};this.divide=function(e,t){if(typeof e=="string"&&e!=""){t=isNaN(t)==true?1:t;this.set(e,{DIV:t})}return this};this.pushValue=function(e,t,n){if(e&&t&&typeof e==="string"){var r={PUSH:{data:t}};if(typeof n==="number"){r.PUSH.index=n}a[e]=r}return this};this.pullValue=function(e,n){if(typeof e==="string"&&e!=""&&n){if(typeof a[e]==="undefined"){a[e]={}}if(typeof a[e]["PULL"]==="undefined"){a[e]["PULL"]={}}if(typeof a[e]["PULL"]["data"]==="undefined"){a[e]["PULL"]["data"]=[]}if(t.Util.dataType(n)=="array"){a[e]["PULL"]["data"]=a[e]["PULL"]["data"].concat(n)}else{a[e]["PULL"]["data"].push(n)}}return this};this.pullValueAtIndex=function(e,t){if(typeof e==="string"&&isNaN(t)==false){if(typeof a[e]==="undefined"){a[e]={}}if(typeof a[e]["PULL"]==="undefined"){a[e]["PULL"]={}}a[e]["PULL"]["index"]=parseInt(t)}return this};this.set=function(e,t){if(typeof e=="object"){for(var n in e){if(me._validate(n,e[n])){this.trigger("change, change:"+n,this,e[n],a[n]);a[n]=e[n]}}}else if(typeof e=="string"){if(me._validate(e,t)){this.trigger("change, change:"+e,this,t,a[e]);a[e]=t}}o=this.get("uid")||undefined;return this};this.setReferenceWhere=function(e,t){if(typeof e=="string"&&t){a[e]={WHERE:t}}return this};this.setReference=function(e,n){if(typeof e=="string"&&n){if(t.Util.dataType(a[e])!="array"){a[e]=[]}if(t.Util.dataType(n)=="array"){a[e]=a[e].concat(n)}else{a[e].push(n)}}return this};this.setLocation=function(e){if(e instanceof t.Location){var n=e.toJSON();this.set("__loc",[n.longitude,n.latitude])}else{throw new Error("Built.Location object required")}return this};this.getLocation=function(){return new t.Location(this.get("__loc"))};this.updateValue=function(e,t,n){if(typeof e=="string"&&isNan(n)==false&&t){a[e]={UPDATE:{data:t,index:n}}}return this};this.fetch=function(e){if(typeof this.class_uid!=="string"||this.class_uid.length<=0||typeof o!=="string"||o.length<=0){throw new Error("object uid and class uid required")}e=e||{};var t,n={};var r=m(e);e=r.__options;var i=function(t,n){try{t=JSON.parse(t)}catch(r){}if(t&&typeof t==="object"&&typeof t.object!=="undefined"){s=t.object;o=t.object.uid;a={};var i=Object.keys(t);for(var u=0;u<i.length;u++){if(i[u]!=="object"){me[i[u]]=t[i[u]]}}me.trigger("fetch:data",t.object);if(typeof e.onSuccess=="function"){e.onSuccess(t.object,n)}}else{if(typeof e.onError=="function"){e.onError(t,n)}}};n.class_uid=this.class_uid;if(o){n.object_uid=o}var f=g.OBJECT.fetch(p(),u,i,n);r._XHR=f._XHR;r.abort=f.abort;return r};this.saveAsDraft=function(e){this.set({published:false});return this.save(e)};this.addQuery=function(e,t){if(e&&typeof e==="string"&&t){u[e]=t}return this};this.includeFilter=this.addQuery;this.setACL=function(e){if(typeof e=="object"&&typeof e.toJSON=="function"){var t=e.toJSON();this.set("ACL",t)}else if(typeof e==="boolean"){this.set("ACL",{disable:e})}return this};this.save=function(e){e=e||{};var n={};var r=m(e);e=r.__options;var i=function(t,n){try{t=JSON.parse(t)}catch(r){}if(typeof t==="object"&&typeof t.object!=="undefined"){s=t.object;o=t.object.uid;a={};var i=Object.keys(t);for(var u=0;u<i.length;u++){if(i[u]!=="object"){me[i[u]]=t[i[u]]}}me.trigger("save",t.object);if(typeof e.onSuccess=="function"){e.onSuccess(t.object,n)}}else{if(typeof e.onError=="function"){e.onError(t,n)}}};n.class_uid=this.class_uid;if(o){n.object_uid=o}if(typeof o=="string"&&o.length>0){u.object=a;var f=g.OBJECT.update(p(),u,i,n);r._XHR=f._XHR;r.abort=f.abort}else{var c=t.Util.mix({object:a},l);c=t.Util.mix(c,u);var f=g.OBJECT.create(p(),c,i,n);r._XHR=f._XHR;r.abort=f.abort}return r};this.destroy=function(e){e=e||{};var t={};var n=m(e);e=n.__options;var r=function(t,n){try{t=JSON.parse(t)}catch(r){}if(t&&typeof t=="object"&&typeof t.notice!=="undefined"){o=null;s={};a={};me.trigger("destroy",t);if(typeof e.onSuccess=="function"){e.onSuccess(t,n)}}else{if(typeof e.onError=="function"){e.onError(t,n)}}};t.class_uid=this.class_uid;if(o){t.object_uid=o;var i=g.OBJECT.destroy(p(),{},r,t);n._XHR=i._XHR;n.abort=i.abort;return n}else{throw new Error("no object uid found")}return this};this.includeOwner=function(){u.include_owner=true;return this};this.includeCount=function(){u.include_count=true;return this};this.getSchema=function(e){e=e||{};var t=m(e);e=t.__options;var n=d(e,this);t._XHR=n._XHR;t.abort=n.abort;return t};var d=function(e,n){if(t.Util.dataType(i)=="array"){if(typeof e.onSuccess=="function"){e.onSuccess(i)}}var r={},s=e.onSuccess,o=function(t,r){try{t=JSON.parse(t)}catch(o){}if(typeof t=="object"&&t["class"]){i=t["class"].schema;n.trigger("fetch:schema",i);if(typeof s=="function"){s(i,r)}}else{if(typeof e.onError=="function"){e.onError(t,r)}}};e.onSuccess=o;r.class_uid=n.class_uid;return g["CLASS"].fetch(p(),{},o,r)};this.has=function(e){return hasOwnProperty.call(s,e)};this.get=function(e){if(e){return typeof a[e]!=="undefined"?a[e]:typeof s[e]!=="undefined"?s[e]:undefined}return undefined};this.setUid=function(e){return this.set("uid",e)};this.clone=function(){return new this.constructor(s)};this.isNew=function(){return!o};this.toJSON=function(){var e=t.Util.clone(s);return t.Util.mix(e,a)};this.dirtyJSON=function(){return t.Util.clone(a)};this.oldJSON=function(){return t.Util.clone(s)};this.setHeader=function(e,t){if(e&&t&&typeof e==="string"&&typeof t==="string"){c[e]=t}return this};this.addHeader=this.setHeader;this.removeHeader=function(e){if(e&&typeof e==="string"&&c[e]){delete c[e]}return this};this.setMasterKey=function(e){if(e&&typeof e==="string"&&e.length){this.setHeader("master_key",e)}return this};this.removeMastkerKey=function(){return this.removeHeader("master_key")}};t.Object=t.Events.inherit(t.Object);t.Object.ModelType={BACKBONE:"BACKBONE",NATIVE:"NATIVE",NONE:"NONE"};t.Object.BACKBONE="BACKBONE";t.Object.NATIVE="NATIVE";t.Object.NONE="NONE";t.Object.extend=function(e){if(typeof e=="string"){e={class_uid:e};return v.call(t.Object,e)}return v.apply(t.Object,arguments)}})(e);(function(e){var t=e;t.ACL=function(e){var n=e;var r={};if(typeof n!=="undefined"){if(n instanceof t.ACL){n=n.toJSON()}if(t.Util.dataType(n)!="object"){try{n=JSON.parse(n)}catch(i){}}if(t.Util.dataType(n)=="object"){r=n}}this.__getAccess=function(e,t,n){if(typeof e==="undefined"||typeof t==="undefined"||typeof n==="undefined"){return undefined}var i=r[e];if(typeof i!=="object"&&i!==undefined){return undefined}for(var s=0,o=i.length;s<o;s++){if(i[s].uid&&i[s].uid==n&&i[s][t]&&i[s][t]==true){return true}}return false};this.__setAccess=function(e,n,i,s){if(typeof e==="undefined"||typeof n==="undefined"||typeof i==="undefined"||typeof s==="undefined"){return}if(t.Util.dataType(s)=="boolean"&&i){var o=r[e];if(typeof o!=="object"){r[e]=[];o=r[e]}for(var u=0,a=o.length;u<a;u++){if(o[u].uid&&o[u].uid==i){o[u][n]=s;return}}var f={};f.uid=i;f[n]=s;r[e].push(f)}return this};this.__setOthers=function(e,n){if(t.Util.dataType(n)=="boolean"&&e){if(typeof r.others!=="object"){r.others={}}r.others[e]=n}return this};this.__getOthers=function(e){if(typeof r.others!=="object"){return false}return r.others[e]};this.__setDisable=function(e){if(typeof e==="boolean"){r["disable"]=e}return this};this.__isDisabled=function(){return r["disable"]};this.__getd=function(){return t.Util.clone(r)}};t.Util.extend(t.ACL.prototype,{getPublicReadAccess:function(){return this.__getOthers("read")},getPublicWriteAccess:function(){return this.__getOthers("update")},getPublicDeleteAccess:function(){return this.__getOthers("delete")},getUserReadAccess:function(e){return this.__getAccess("users","read",e)},getUserWriteAccess:function(e){return this.__getAccess("users","update",e)},getUserDeleteAccess:function(e){return this.__getAccess("users","delete",e)},getRoleReadAccess:function(e){return this.__getAccess("roles","read",e)},getRoleWriteAccess:function(e){return this.__getAccess("roles","update",e)},getRoleDeleteAccess:function(e){return this.__getAccess("roles","delete",e)},setPublicReadAccess:function(e){if(t.Util.dataType(e)=="boolean"){this.__setOthers("read",e)}return this},setPublicWriteAccess:function(e){if(t.Util.dataType(e)=="boolean"){this.__setOthers("update",e)}return this},setPublicDeleteAccess:function(e){if(t.Util.dataType(e)=="boolean"){this.__setOthers("delete",e)}return this},setUserReadAccess:function(e,t){return this.__setAccess("users","read",e,t)},setUserWriteAccess:function(e,t){return this.__setAccess("users","update",e,t)},setUserDeleteAccess:function(e,t){return this.__setAccess("users","delete",e,t)},setRoleReadAccess:function(e,t){return this.__setAccess("roles","read",e,t)},setRoleWriteAccess:function(e,t){return this.__setAccess("roles","update",e,t)},setRoleDeleteAccess:function(e,t){return this.__setAccess("roles","delete",e,t)},disable:function(e){return this.__setDisable(e)},isDisabled:function(){return this.__isDisabled()},toJSON:function(){return this.__getd()}})})(e);(function(e){var t=e;t.Query=function(e){function y(e){if(e){return t.Util.mix(t.Util.mix(d,v.headers),e)}return t.Util.mix(d,v.headers)}function b(e,t,n,r){if(r){if(typeof a[r]==="undefined"){a[r]={}}if(typeof a[r][e]==="undefined"){a[r][e]={}}a[r][e][t]=n}return this}function w(e,t){if(typeof e=="object"){if(typeof e[t]!="object"){e[t]={}}}}function E(e){if(e&&e!=null&&typeof e=="object"){h=e;return h}else{if(typeof h==="object"&&h!=null&&h!=undefined&&h!=""){return h}return S()}}function S(){var e=a["query"]||null;var n=t.Util.clone(a);var r=false;if(l.length>0){n["query"]={};for(var i=0;i<l.length;i++){if(typeof n["query"]["$or"]!="object"){n["query"]["$or"]=[]}if(typeof l[i]!=="undefined"&&typeof l[i]["query"]=="object"){n["query"]["$or"].push(l[i]["query"])}}if(e!=null){n["query"]=t.Util.mix(n["query"],e)}}if(c.length>0){if(l.length<1){n["query"]={}}for(var i=0;i<c.length;i++){if(typeof n["query"]["$and"]!="object"){n["query"]["$and"]=[]}if(typeof c[i]!=="undefined"&&typeof c[i]["query"]=="object"){n["query"]["$and"].push(c[i]["query"])}}if(e!=null){n["query"]=t.Util.mix(n["query"],e)}}return n}if(typeof e!=="string"){throw new Error("class uid required")}var r=e;var s=n;var o=this,u=false;var a={};var l=[];var c=[];var h=null;var p=true;var d=t.Util.clone(f);var v={headers:{},info:{}};this.__toObjectModel__=function(e,n){n=n||r;if(!n){throw new Error("class uid required")}var i=[],s;if(t.Util.dataType(e)=="array"){for(var o=0,u=e.length;o<u;o++){if(typeof e[o]=="object"&&e[o].uid&&typeof e[o].uid=="string"){i[i.length]=new t.Object(n,e[o],true)}}return i}else if(t.Util.dataType(e)=="object"){if(typeof e=="object"&&e.uid&&typeof e.uid=="string"){s=new t.Object(n,e,true);return s}}return null};this.__toBackboneModel__=function(e,n){n=n||r;if(!n){throw new Error("class uid required")}var i="object";if(t.Util.dataType(e)=="array"){i="array";if(e.length==0){return e}}if(typeof Backbone!=="undefined"&&Backbone.Model&&Backbone.Collection){var s=Backbone.Model.extend({idAttribute:"uid",initialize:function(e){},sync:function(e,n,i){if(arguments.length==2){i=n;n={}}i=i||{};var s=new t.Object(r,this.toJSON(),true);s.set(this.changed);if(e=="read"){return s.fetch(i)}else if(e=="create"||e=="update"){return s.save(i)}else if(e=="delete"){return s.destroy(i)}return null}});if(i=="object"){return new s(e)}else{var o=Backbone.Collection.extend({model:s,sync:function(e,n,i){if(arguments.length==2){i=n;n={}}i=i||{};var s=new t.Object(r,this.toJSON(),true);s.set(this.changed);if(e=="read"){var o=new t.Query(r);return o.exec(i)}return null}});o=new o;for(var u=0,a=e.length;u<a;u++){if(typeof e[u]=="object"){o.add(new s(e[u]))}}return o}}else{return this.__toObjectModel__(e,r)}};this.setUser=function(e){if(e&&typeof e.getHeaders==="function"){v.headers=e.getHeaders();v.info=e.getInfo()}return me};this.modelType=function(e){p=e;return this};this.setModelType=function(e){p=e;return this};this.setCachePolicy=function(e){s=e;return o};this.getClassUid=function(){return r};this.setHeader=function(e,t){if(e&&t&&typeof e=="string"&&typeof t=="string"){d[e]=t}return this};this.addHeader=this.setHeader;this.removeHeader=function(e){if(e&&typeof e==="string"&&d[e]){delete d[e]}return this};this.setMasterKey=function(e){if(e&&typeof e==="string"&&e.length){this.setHeader("master_key",e)}return this};this.removeMastkerKey=function(){return this.removeHeader("master_key")};this.exec=function(e){if(typeof r!="string"){throw new Error("class uid required")}e=e||{};var t=this,n={},i=e.query||E();n.class_uid=e.class_uid||r;var u=JSON.stringify(y())+n.class_uid+JSON.stringify(i);try{i=JSON.parse(i)}catch(a){}var f=m(e);e=f.__options;f.__preserve(true);var l=function(){var n=O.encode(u);var r=M.get(n);var i={type:"CACHE"};if(r){try{r=JSON.parse(r);if(p==="BACKBONE"){var a=typeof r.objects!=="undefined"?r.objects:typeof r.object!=="undefined"?r.object:r;if(typeof e.onSuccess=="function"){var f=t.__toBackboneModel__(a,o.class_uid);for(var l in r){if(l!=="object"&&l!=="objects"){f[l]=r[l]}}e.onSuccess(f,i)}}else if(e.model===false||p=="NONE"){if(typeof e.onSuccess=="function"){e.onSuccess(r,i)}}else{var a=typeof r.objects!=="undefined"?r.objects:typeof r.object!=="undefined"?r.object:[];if(typeof e.onSuccess=="function"){var f=t.__toObjectModel__(a,t.class_uid);for(var l in r){if(l!=="object"&&l!=="objects"){f[l]=r[l]}}e.onSuccess(f,i)}}if(s=="only_cache"||s=="cache_else_network"){return{_XHR:null,abort:function(){}}}}catch(c){if(typeof e.onError=="function"){e.onError({error_message:"no cache found"},i)}}}else{if(s=="cache_else_network"&&typeof h=="function"){return h()}else if(typeof e.onError=="function"){e.onError({error_message:"no cache found"},i)}}if(s=="cache_then_network"&&typeof h==="function"){return h()}};var c=function(n,r){r=r||{};try{n=JSON.parse(n)}catch(i){}try{r["type"]="NETWORK"}catch(i){}if(n&&typeof n=="object"&&typeof n.objects!=="undefined"){if(s!="only_network"){M.set(O.encode(u),JSON.stringify(n))}var o=typeof n.objects!=="undefined"?n.objects:typeof n.object!=="undefined"?n.object:[];if(p==="BACKBONE"){if(typeof e.onSuccess=="function"){var a=t.__toBackboneModel__(o);for(var f in n){if(f!=="object"&&f!=="objects"){a[f]=n[f]}}e.onSuccess(a,r)}}else if(e.model===false||p==="NONE"){if(typeof e.onSuccess=="function"){e.onSuccess(n,r)}}else{if(typeof e.onSuccess=="function"){var a=t.__toObjectModel__(o);for(var f in n){if(f!=="object"&&f!=="objects"){a[f]=n[f]}}e.onSuccess(a,r)}}}else{if(typeof e.onError=="function"){e.onError(n,r)}}};var h=function(){return g.OBJECT.fetch(y(),i,c,n)};if(s==="only_cache"){var d=l();f._XHR=d._XHR;f.abort=d.abort;return f}else if(s==="cache_else_network"){var d=l();f._XHR=d._XHR;f.abort=d.abort;return f}else if(s==="network_else_cache"){var v=e.onError;e.onError=function(){e.onError=v;return l()};var d=h();f._XHR=d._XHR;f.abort=d.abort;return f}else if(s==="cache_then_network"){var d=l();f._XHR=d._XHR;f.abort=d.abort;return f}else{var d=h();f._XHR=d._XHR;f.abort=d.abort;return f}};this.notInQuery=function(e,n){if(e&&n){var r,i={},s,o,u;if(n instanceof t.Query&&typeof n.toJSON==="function"){u=n.toJSON().query}else{u=n}if(e.indexOf(">")>=0){r=e.split(">");o=r[0];_count=e.length-1;for(var f=r.length;f>0;f--){if(r[f-1]!=""){s=i;i={};i[r[f-1]]={$nin_query:f==r.length?u:s}}}}else{i[e]={$nin_query:u}}if(typeof a["query"]!="object"){a["query"]={}}a["query"]=t.Util.mix(a["query"],i)}return this};this.inQuery=function(e,n){if(e&&n){var r,i={},s,o,u;if(n instanceof t.Query&&typeof n.toJSON==="function"){u=n.toJSON().query}else{u=n}if(e.indexOf(">")>=0){r=e.split(">");o=r[0];_count=e.length-1;for(var f=r.length;f>0;f--){if(r[f-1]!=""){s=i;i={};i[r[f-1]]={$in_query:f==r.length?u:s}}}}else{i[e]={$in_query:u}}if(typeof a["query"]!="object"){a["query"]={}}a["query"]=t.Util.mix(a["query"],i)}return this};this.tags=function(){a["tags"]=a["tags"]||[];for(i=0;i<arguments.length;i++){if(typeof arguments[i]=="string"){a["tags"]=a["tags"].concat(arguments[i].split(/[\s,]+/))}else if(t.Util.dataType(arguments[i])=="array"){a["tags"]=a["tags"].concat(arguments[i])}}return this};this.where=function(e,t){if(typeof a["query"]!="object"){a["query"]={}}a["query"][e]=t;return this};this.skip=function(e){if(t.Util.dataType(e)=="number"&&parseInt(e)>=0){a["skip"]=e}return this};this.limit=function(e){if(t.Util.dataType(e)=="number"&&parseInt(e)>0){a["limit"]=e}return this};this.includeSchema=function(){a["include_schema"]=true;return this};this.includeCount=function(){a["include_count"]=true;return this};this.includeOwner=function(){a["include_owner"]=true;return this};this.beforeUid=function(e){if(t.Util.dataType(e)=="string"){a["before_uid"]=e}return this};this.afterUid=function(e){if(t.Util.dataType(e)=="string"){a["after_uid"]=e}return this};this.includeDrafts=function(){a["include_unpublished"]=true;return this};this.onlyDrafts=function(){this.includeDrafts();if(typeof a["query"]!="object"){a["query"]={}}a.query["published"]=false;return this};this.notEqualTo=function(e,t){b(e,"$ne",t,"query");return this};this.lessThan=function(e,t){b(e,"$lt",t,"query");return this};this.greaterThan=function(e,t){b(e,"$gt",t,"query");return this};this.lessThanOrEqualTo=function(e,t){b(e,"$lte",t,"query");return this};this.greaterThanOrEqualTo=function(e,t){b(e,"$gte",t,"query");return this};this.containedIn=function(e,t){if(typeof t!="object"){t=[t]}b(e,"$in",t,"query");return this};this.notContainedIn=function(e,t){if(typeof t!="object"){t=[t]}b(e,"$nin",t,"query");return this};this.exists=function(e){b(e,"$exists",true,"query");return this};this.doesNotExist=function(e){b(e,"$exists",false,"query");return this};this.matches=function(e,t,n){if(typeof a["query"]==="undefined"){a["query"]={}}if(typeof a["query"][e]==="undefined"){a["query"][e]={}}a["query"][e]["$regex"]=t;if(n){a["query"][e]["$options"]=n}return this};this.include=function(e){if(t.Util.dataType(a["include"])!="array"){a["include"]=[]}if(t.Util.dataType(e)=="array"){for(var n=0,r=e.length;n<r;n++){a["include"].push(e[n])}}else{a["include"].push(e)}return this};this.only=function(e,n){if(typeof a["only"]!=="object"){a["only"]={}}if(typeof n==="string"){if(typeof a["only"][n]!=="object"){a["only"][n]=[]}if(t.Util.dataType(e)=="array"){a["only"][n]=a["only"][n].concat(e)}else{a["only"][n].push(e)}}else{if(typeof a["only"]["BASE"]!=="object"){a["only"]["BASE"]=[]}if(t.Util.dataType(e)=="array"){a["only"]["BASE"]=a["only"]["BASE"].concat(e)}else{a["only"]["BASE"].push(e)}}return this};this.except=function(e,n){if(typeof a["except"]!=="object"){a["except"]={}}if(typeof n==="string"){if(typeof a["except"][n]!=="object"){a["except"][n]=[]}if(t.Util.dataType(e)=="array"){a["except"][n]=a["except"][n].concat(e)}else{a["except"][n].push(e)}}else{if(typeof a["except"]["BASE"]!=="object"){a["except"]["BASE"]=[]}if(t.Util.dataType(e)=="array"){a["except"]["BASE"]=a["except"]["BASE"].concat(e)}else{a["except"]["BASE"].push(e)}}return this};this.addQuery=function(e,t){if(typeof e=="string"&&t){a[e]=t}return this};this.includeFilter=this.addQuery;this.ascending=function(e){if(typeof e=="string"){a["asc"]=e}return this};this.descending=function(e){if(typeof e=="string"){a["desc"]=e}return this};this.and=function(e){for(var n=0,r=arguments.length;n<r;n++){if(arguments[n]instanceof t.Query&&typeof arguments[n]["toJSON"]==="function"){c.push(arguments[n]["toJSON"]())}}return this};this.or=function(e){for(var n=0,r=arguments.length;n<r;n++){if(arguments[n]instanceof t.Query&&typeof arguments[n]["toJSON"]==="function"){l.push(arguments[n]["toJSON"]())}}return this};this.select=function(e,n,r){if(n instanceof t.Query&&typeof n["toJSON"]==="function"&&n.getClassUid()!=""&&n.getClassUid()!=="undefined"&&typeof r==="string"&&r!=""){if(typeof a["query"]!="object"){a["query"]={}}a["query"][e]={$select:{query:n.toJSON().query,class_uid:n.getClassUid(),key:r}}}else{throw new Error("incorrect parameter")}return this};this.dontSelect=function(e,n,r){if(n instanceof t.Query&&typeof n["toJSON"]==="function"&&n.getClassUid()!=""&&n.getClassUid()!=="undefined"&&typeof r==="string"&&r!=""){if(typeof a["query"]!="object"){a["query"]={}}a["query"][e]={$dont_select:{query:n.toJSON().query,class_uid:n.getClassUid(),key:r}}}else{throw new Error("incorrect parameter")}return this};this.nearLocation=function(e,n){n=n||1e3;w(a,"query");if(e instanceof t.Location&&typeof n=="number"){var r=e.toJSON();a["query"]["$near"]={coords:[r.longitude,r.latitude],radius:n}}else if(typeof e=="string"&&typeof n=="number"){a["query"]["$near"]={coords:[r.longitude,r.latitude],radius:n}}else{throw new Error("invalid parameter")}return this};this.withinLocation=function(e){w(a,"query");if(t.Util.dataType(e)=="array"){if(e.length<3){throw new Error("minimum 3 locations or objectUid required")}var n=[];for(var r=0;r<e.length;r++){if(e[r]instanceof t.Location){var i=e[r].toJSON();n.push([i.longitude,i.latitude])}else if(typeof e[r]=="string"){n.push({object:e[r]})}else{throw new Error("invalid parameter, "+i[r])}}a["query"]["$within"]=n}return this};this.toJSON=function(e){return E(e)};this.count=function(e){e=e||{};var t=m(e);e=t.__options;if(typeof r=="string"&&r.length>0){var n,i=this,s={};var o=function(t,n){try{t=JSON.parse(t)}catch(r){}if(t&&typeof t=="object"&&typeof t.objects!=="undefined"){if(typeof e.onSuccess=="function"){e.onSuccess(t.objects,n)}}else{if(typeof e.onError=="function"){e.onError(t,n)}}};s.class_uid=r;var u=opt=E()||{};u.count=true;var a=g.OBJECT.fetch(y(),u,o,s);t._XHR=a._XHR;t.abort=a.abort;return t}else{if(typeof e=="object"&&typeof e.onError=="function"){e.onError({error_message:"incomplete parameters"})}throw new Error("incomplete parameter")}return this}};t.Query.setCachePolicy=function(e){n=e;return t};t.Query.CachePolicy={ONLY_CACHE:"only_cache",ONLY_NETWORK:"only_network",CACHE_ELSE_NETWORK:"cache_else_network",NETWORK_ELSE_CACHE:"network_else_cache",CACHE_THEN_NETWORK:"cache_then_network"}})(e);(function(e){var t=e;t.Location=function(e){var n={longitude:0,latitude:0};var r=function(e,t){if(typeof e!="number"||typeof t!="number"){throw new Error("invalid data type")}if(t<-90||t>90){throw new Error("invalid value for latitude: "+t)}if(e<-180||e>180){throw new Error("invalid value for longitude: "+e)}};if(t.Util.dataType(e)=="object"){if(e.longitude&&e.longitude){r(e.longitude,e.longitude);n.longitude=e.longitude;n.latitude=e.latitude}}else if(t.Util.dataType(e)=="array"){if(e.length>=2){r(e[0],e[1]);n.longitude=e[0];n.latitude=e[1]}}else if(arguments.length>=2){r(arguments[0],arguments[1]);n.longitude=arguments[0];n.latitude=arguments[1]}this.getRadians=function(e){if(e instanceof t.Location){var r=e.toJSON();var i=Math.PI/180,s=n.latitude*i,o=n.longitude*i,u=r.latitude*i,a=r.longitude*i,f=s-u,l=o-a,c=Math.sin(f/2),h=Math.sin(l/2);var p=c*c+Math.cos(s)*Math.cos(u)*h*h;p=Math.min(1,p);return 2*Math.asin(Math.sqrt(p))}else{throw new Error("Built.Location object required")}};this.setLocation=function(e,t){if(typeof e=="number"&&typeof t=="number"){r(e,t);n.longitude=e;n.latitude=t}return this};this.kilometersFrom=function(e){return this.getRadians(e)*6371},this.milesFrom=function(e){return this.getRadians(e)*3958.8};this.toJSON=function(){return{longitude:n.longitude,latitude:n.latitude}}};t.Location.getCurrentLocation=function(e){e=e||{};var n=m(e);e=n.__options;if(typeof navigator!=="undefined"&&typeof navigator.geolocation!=="undefined"){navigator.geolocation.getCurrentPosition(function(n){if(typeof e.onSuccess=="function"){e.onSuccess(new t.Location({latitude:n.coords.latitude,longitude:n.coords.longitude}))}},function(t){if(typeof e.onError=="function"){e.onError({error_message:t.message,code:t.code,object:t})}})}else{if(typeof e.onError=="function"){e.onError({error_message:"Geo functionality is not supported by the platform"})}}return n}})(e);(function(e){var t=e;t.Role={class_uid:"built_io_application_user_role",setName:function(e){if(typeof e=="string"&&e!=""){return this.set("name",e)}return this},getName:function(){return this.get("name")},setRoleUid:function(e){if(typeof e=="string"&&e!=""){return this.set("uid",e)}return this},getRoleUid:function(e){return this.get("uid")},addUser:function(e){var t;if(typeof e=="object"&&typeof e.uid=="string"){t=e.uid}else if(typeof e=="string"){t=e}if(t){var n=this.get("users")||[];for(var r=0;r<n.length;r++){if(t==n[r]){return this}}n.push(t);this.set("users",n)}return this},removeUser:function(e){var t;if(typeof e=="object"){if(e.uid){t=e.uid}}else if(typeof e=="string"){t=e}if(t){var n=this.get("users")||[];for(var r=0;r<n.length;r++){if(t==n[r]){n.splice(r,1);this.set("users",n)}}}return this},addRole:function(e){var t;if(typeof e=="object"&&typeof e.uid=="string"){t=e.uid}else if(typeof e=="string"){t=e}if(t){var n=this.get("roles")||[];for(var r=0;r<n.length;r++){if(t==n[r]){return this}}n.push(t);this.set("roles",n)}return this},removeRole:function(e){var t;if(typeof e=="object"&&typeof e.uid=="string"){t=e.uid}else if(typeof user=="string"){t=e}if(t){var n=this.get("roles")||[];for(var r=0;r<n.length;r++){if(t==n[r]){n.splice(r,1);this.set("roles",n)}}}return this},hasUser:function(e){if(e){var t=this.get("users")||[];if(t.indexOf(e)>=0){return true}}return false},hasRole:function(e){if(e){var t=this.get("roles")||[];if(t.indexOf(e)>=0){return true}}return false},getUsers:function(){return this.get("users")||[]},getRoles:function(){return this.get("roles")||[]}};t.Role=v.call(t.Object,t.Role);t.Role.getRoleQuery=function(){return new t.Query("built_io_application_user_role")}})(e);(function(e){var t=e;t.Promise=function(){var e=[],n=[],r=[],i=false,s=false,o=[],u,a=false,f=false;this.success=function(t,n){if(typeof t=="function"){n=n||this;if(s){u=t.apply(n,o);e=[]}e.push({callback:t,context:n})}return this};this.error=function(e,t){if(typeof e=="function"){t=t||this;if(i){u=e.apply(t,o);n=[]}n.push({callback:e,context:t})}return this};this.always=function(e,t){if(typeof e=="function"){t=t||this;if(i||s){e.apply(t,o);r=[]}r.push({callback:e,context:t})}return this};this.resolve=function(){if((s||i)&&a===false){return this}s=true;o=Array.prototype.slice.call(arguments);for(var t=0,n=e.length;t<n;t++){var r=e[t];if(r){try{u=r.callback.apply(r.context,o)}catch(c){f=true;u=c}}}if(!a){e=[]}l();return this};this.reject=function(){if((i||s)&&a===false){return this}i=true;o=Array.prototype.slice.call(arguments);for(var e=0,t=n.length;e<t;e++){var r=n[e];if(r){try{u=r.callback.apply(r.context,o)}catch(c){f=true;u=c}}}if(!a){n=[]}l();return this};this.isFulfilled=function(){return s||i};this.then=function(r,i){var s=new t.Promise;if(typeof r!=="function"&&e.length>0&&typeof e[0]=="object"){r=e.shift().callback}if(typeof i!=="function"&&n.length>0&&typeof e[0]=="object"){i=n.shift().callback}var o=function(e,n){if(e&&t.Promise.isPromise(e)){e.then(function(){s.resolve.apply(s,arguments)},function(){s.reject.apply(s,arguments)})}else{if(!e||t.Util.dataType(e)!=="array"){if(!e){e=""}e=[e]}if(n||f){try{s.reject.apply(s,e)}catch(r){s.reject.call(s,e.length?e[0]:e)}}else{try{s.resolve.apply(s,e)}catch(r){s.resolve.call(s,e.length?e[0]:e)}}}};var a=function(){var e=arguments;if(typeof r==="function"){try{o(r.apply(this,e))}catch(t){o(t,true)}}else{o(u||e)}};var l=function(){var e=arguments;if(typeof i==="function"){try{o(i.apply(this,e))}catch(t){o(t,true)}}else{o(u||e,true)}};this.success(a);this.error(l);return s};var l=function(){for(var e=0,t=r.length;e<t;e++){var n=r[e];if(n){n.callback.apply(n.context,o)}}if(!a){r=[]}};this.__preserve=function(e){if(typeof e==="boolean"){a=e}}};t.Promise.when=function(){var e=[];for(var n in arguments){if(t.Util.dataType(arguments[n])==="array"){e=e.concat(arguments[n])}else if(typeof arguments[n]==="object"){e.push(arguments[n])}}var r=e.length,i=new t.Promise;if(r===0){i.resolve();return i}var s=r,o=[],u=[],a=false;var f=function(){--s;if(s===0){if(a){i.reject(o,u)}else{i.resolve(u)}}};t.Util.each(e,function(e,n){if(t.Promise.isPromise(e)){e.then(function(e){u[n]=e;f()},function(e){o[n]=e;u[n]=e;a=true;f()})}else{u[n]=e;f()}});return i};t.Promise.isPromise=function(e){return typeof e==="object"&&typeof e.then==="function"}})(e);(function(e){var t=e;t.Application={};t.Application.fetchSettings=function(e){e=e||{};var t=m(e);e=t.__options;var n=function(t,n){try{t=JSON.parse(t)}catch(r){}if(typeof t=="object"&&typeof t.application!=="undefined"){if(typeof e.onSuccess=="function"){e.onSuccess(t,n)}}else{if(typeof e.onError=="function"){e.onError(t,n)}}};var r=g.APP_SETTINGS.fetch(f,{include_application_variables:true},n);t._XHR=r._XHR;t.abort=r.abort;return t};t.Application.getUserQuery=function(){return new t.Query("built_io_application_user")};t.Application.getRoleQuery=function(){return new t.Query("built_io_application_user_role")}})(e);(function(e){var n=e;n.Extension={};n.Extension.execute=function(e,n,r,i){var s=f["application_api_key"];i=i||{};if(r&&(r.success||r.error||r.onSuccess||r.onError)){i=r;r={}}var o=m(i);i=o.__options;if(typeof s=="string"&&s!==""&&typeof e==="string"){if(!n||typeof n!=="object"){n={}}if(!r||typeof r!=="object"){r={}}var u=p(t.Base+t.extensionURL+e);if(!r.application_api_key){r.application_api_key=s}var a=function(e,t){if(t.status==200){try{e=JSON.parse(e)}catch(n){}if(typeof i.onSuccess=="function"){i.onSuccess(e,t)}}else if(typeof i.onError=="function"){i.onError(e,t)}};var l=y(u,r,n,a);o._XHR=l._XHR;o.abort=l.abort}else{if(typeof i==="function"){i({error_message:"parameter required (function_name, application_api_key)"},null)}}return o};n.Extension.define=function(e,t){return this};n.Extension.beforeSave=function(e,t){return this};n.Extension.afterSave=function(e,t){return this};n.Extension.http={get:function(){},put:function(){},del:function(){},post:function(){}}})(e);(function(e){var t=e;t.Analytics={};t.Analytics.Event=function(e){var n=e||"";var r={properties:{}};var i={};this.setPreviousEventUid=function(e){if(typeof e==="string"){r["previous_event_uid"]=e}return this},this.setCreatedAt=function(e){if(e instanceof Date&&typeof e.toISOString=="function"){r["created_at"]=e.toISOString()}return this};this.setProperties=function(e){if(e&&typeof e=="object"){r.properties=t.Util.mix(r.properties,e);return this}throw new Error("object required")};this.addAttributes=this.setProperties;this.setUid=function(e){if(typeof e=="string"){n=e}return this};this.trigger=function(e){if(n!=""){e=e||{};var t=this.toJSON();var s=m(e);e=s.__options;var o=function(t,n){try{t=JSON.parse(t)}catch(s){}if(typeof t.notice!=="undefined"){r={};i={};if(typeof e.onSuccess=="function"){e.onSuccess(t,n)}}else{if(typeof e.onError=="function"){e.onError(t,n)}}};var u=g.AS.trigger(f,t,o);s._XHR=u._XHR;s.abort=u.abort;return s}throw new Error("event uid required, use setUid method to set event uid")};this.appendEvent=function(e){if(e instanceof t.Analytics.Event&&typeof e.toJSON==="function"){var n=e.toJSON();if(n.events){for(var r in n.events){if(i[r]&&i[r].length){i[r]=i[r].concat(n.events[r])}else{i[r]=n.events[r]}}}}else{throw new Error("Built.Analytics.Event object required")}return this};this.toJSON=function(){if(n||Object.keys(i).length){var e={};if(n){e[n]=[r]}e=t.Util.mix(e,i);return{events:e}}throw new Error("Event UID required")}}})(e);(function(e){var t=e;t.Notification=function(){var e={msg:"",time:"",users:[],local:false};this.setMessage=function(t){if(typeof t==="string"){e.msg=t}else{throw new Error("invalid message type")}return this};this.atTime=function(t){if(t instanceof Date){e.time=t.toISOString()}else{throw new Error("JavaScript date object required")}return this};this.addUsers=function(n){if(typeof n==="string"){e.users.push(n)}else if(t.Util.dataType(n)==="array"){e.users=e.users.concat(n)}return this};this.inLocalTime=function(t){if(typeof t==="boolean"){e.local=t}};this.send=function(t){if(e.msg!==""&&e.users.length>0){t=t||{};var n=m(t);t=n.__options;var r={push:{message:e.msg}};if(e.time!==""){r.push.send_at=e.time;r.push.local_push=e.local}if(e.users.length>0){r.push.user_uids=e.users}var i=function(n,r){try{n=JSON.parse(n)}catch(i){}if(typeof n.notice!=="undefined"){e.time="";e.msg="";e.local=false;e.users=[];if(typeof t.onSuccess==="function"){t.onSuccess(n,r)}}else{if(typeof t.onError==="function"){t.onError(n,r)}}};var s=g.NOTIFICATION.send(f,r,i);n._XHR=s._XHR;n.abort=s.abort;return n}else{throw new Error("message is not set or receivers not added")}}}})(e);(function(e){var t=e;t.Installation=function(){var e=new t.Object("built_io_installation_data",{});this.save=function(){if(!this.getDeviceToken()){return this}if(!e.get("uid")){e.upsert("device_token",this.getDeviceToken())}return e.save.apply(e,arguments)};this.destroy=function(){return e.destroy.apply(e,arguments)};this.fetch=function(){try{return e.fetch.apply(e,arguments)}catch(t){throw new Error("installation uid required")}};this.set=function(){e.set.apply(e,arguments);return this};this.get=function(t){return e.get(t)};this.setTimeZone=function(){var t=(new Date).getTimezoneOffset();var n=Math.abs(t)<60?(t<0?"+":"-")+"0:"+Math.abs(t):(t<0?"+":"-")+(Math.floor(Math.abs(t)/60)+":"+Math.abs(t)%60);e.set("timezone",n);return this};this.setLocation=function(){e.setLocation.apply(e,arguments);return this};this.setDeviceToken=function(t){e.set("device_token",t);return this};this.setInstallationId=function(t){e.set("uid",t);return this};this.setDeviceType=function(t){e.set("device_type",t);return this};this.subscribeChannels=function(n){if(typeof n=="string"&&n!=""||t.Util.dataType(n)=="array"){e.pushValue("subscribed_to_channels",n)}return this};this.unsubscribeChannels=function(n){if(typeof n=="string"&&n!=""||t.Util.dataType(n)=="array"){e.pullValue("subscribed_to_channels",n)}return this};this.getDeviceToken=function(){return e.get("device_token")};this.getDeviceType=function(){return e.get("device_type")};this.getSubscribedChannelList=function(){return e.oldJSON()["subscribed_to_channels"]||[]};this.toJSON=function(){return e.toJSON()};this.dirtyJSON=function(){return e.dirtyJSON()};this.oldJSON=function(){return e.oldJSON()}}})(e);var g={VALIDATE:function(e,t){e=e||{};if(typeof e.application_api_key!=="string"||typeof e.application_uid!=="string"){var n="First initialize built sdk with your application key, eg: Built.initialize('your_application_api_key', 'your_application_uid')";if(typeof t=="function"){t({error_message:n})}return n}return null},OBJECT:{create:function(e,n,r,i){i=i||{};if(g.VALIDATE(e,r)){return{}}if(i.class_uid&&e.application_api_key&&e.application_uid){var s=t.Base+t.classes+i.class_uid+t.objects;s=p(s);return y(s,e,n,r)}else if(typeof r=="function"){r({error_message:"provide all parameters"})}return this},fetch:function(e,n,r,i){if(g.VALIDATE(e,r)){return{}}i=i||{};if(i.class_uid&&e.application_api_key&&e.application_uid){var s=t.Base+t.classes+i.class_uid+t.objects+(i.object_uid?i.object_uid:"");s=p(s);return b(s,e,n,r)}else if(typeof r=="function"){r({error_message:"provide all parameters"})}return this},update:function(e,n,r,i){i=i||{};if(g.VALIDATE(e,r)){return{}}if(i.class_uid&&i.object_uid&&e.application_api_key&&e.application_uid){var s=t.Base+t.classes+i.class_uid+t.objects+i.object_uid;s=p(s);return E(s,e,n,r)}else if(typeof r=="function"){r({error_message:"provide all parameters"})}return this},destroy:function(e,n,r,i){i=i||{};if(g.VALIDATE(e,r)){return{}}if(i.class_uid&&i.object_uid&&e.application_api_key&&e.application_uid){var s=t.Base+t.classes+i.class_uid+t.objects+i.object_uid;s=p(s);return w(s,e,n,r)}else if(typeof r=="function"){r({error_message:"provide all parameters"})}return this}},CLASS:{fetch:function(e,n,r,i){i=i||{};if(g.VALIDATE(e,r)){return{}}if(i.class_uid&&e.application_api_key&&e.application_uid){var s=t.Base+t.classes+i.class_uid;s=p(s);return b(s,e,n,r)}else if(typeof r=="function"){r({error_message:"provide all parameters"})}return this}},USER:{login:function(e,n,r,i){if(g.VALIDATE(e,r)){return{}}if(e.application_api_key&&e.application_uid){var s=t.Base+"/"+t.login;s=p(s);return y(s,e,n,r)}else if(typeof r==="function"){r({error_message:"provide all parameters"})}return this},logout:function(e,n,r,i){if(g.VALIDATE(e,r)){return{}}if(e.application_api_key&&e.application_uid&&e.authtoken){var s=t.Base+"/"+t.logout;s=p(s);return w(s,e,n,r)}else if(typeof r=="function"){r({error_message:"provide all parameters"})}return this},fetchUserInfo:function(e,n,r,i){if(g.VALIDATE(e,r)){return{}}if(e.application_api_key&&e.application_uid&&e.authtoken){var s=t.Base+"/"+t.getUserInfo;s=p(s);return b(s,e,{},r)}else if(typeof r==="function"){r({error_message:"provide all parameters"})}return this},register:function(e,n,r,i){if(g.VALIDATE(e,r)){return{}}if(e.application_api_key&&e.application_uid){var s=t.Base+"/"+t.user;s=p(s);return y(s,e,n,r)}else if(typeof r=="function"){r({error_message:"provide all parameters"})}return this},forgotPassword:function(e,n,r,i){n=n||{};if(g.VALIDATE(e,r)){return{}}if(e.application_api_key&&e.application_uid&&n.application_user&&n.application_user.email){var s=t.Base+t.forgotPassword;s=p(s);return y(s,e,n,r)}else if(typeof r=="function"){r({error_message:"provide all parameters"})}return this},generateAuthtoken:function(e,n){if(f.application_api_key&&f.master_key){var r=p(t.Base+t.user+t.genAuth);return y(r,f,e,n)}else if(typeof n=="function"){n({error_message:"provide application_api_key and master_key"})}return this},activate:function(e,n,r,i){n=n||{};i=i||{};if(g.VALIDATE(e,r)){return{}}if(e.application_api_key&&e.application_uid&&i.userId&&i.activationToken){var s=t.Base+"/application/users/"+i.userId+"/activate/"+i.activationToken;s=p(s);return b(s,e,n,r)}else if(typeof r=="function"){r({error_message:"provide all parameters"})}return this},deactivate:function(e,n,r,i){n=n||{};i=i||{};if(g.VALIDATE(e,r)){return{}}if(e.application_api_key&&e.application_uid&&e.authtoken&&i.userId){var s=t.Base+"/application/users/"+i.userId;s=p(s);return w(s,e,n,r)}else if(typeof r=="function"){r({error_message:"provide all parameters"})}return this},fetchUidByEmail:function(e,n,r){n=n||{};if(g.VALIDATE(e,r)){return{}}if(e.application_api_key&&e.application_uid){var i=t.Base+"/application/users/retrieve_user_uid";i=p(i);return y(i,e,n,r)}else if(typeof r=="function"){r({error_message:"provide all parameters"})}return this},update:function(e,n,r,i){i=i||{};if(g.VALIDATE(e,r)){return{}}if(e.application_api_key&&e.application_uid&&e.authtoken&&i.uid){var s=t.Base+"/"+t.user+i.uid;s=p(s);n={application_user:n};return E(s,e,n,r)}else if(typeof r=="function"){r({error_message:"provide all parameters"})}return this}},AS:{trigger:function(e,n,r){var i=p(t.Base+"/events/trigger_multiple");n=n||{};if(g.VALIDATE(e,r)){return{}}if(e.application_api_key&&e.application_uid){return y(i,e,n,r)}else if(typeof r=="function"){r({error_message:"provide all parameters"})}return this}},APP_SETTINGS:{fetch:function(e,n,r){if(g.VALIDATE(e,r)){return{}}if(e.application_api_key&&e.application_uid){var i=t.Base+"/applications/"+e.application_uid;i=p(i);return b(i,e,n,r)}else if(typeof r=="function"){r({error_message:"provide all parameters"})}return this}},UPLOAD:{fetch:function(e,n,r,i){i=i||{};if(g.VALIDATE(e,r)){return{}}if(e.application_api_key&&e.application_uid&&i.uid){var s=t.Base+t.upload+i.uid;s=p(s);return b(s,e,n,r)}else if(typeof r=="function"){r({error_message:"provide all parameters"})}return this},destroy:function(e,n,r,i){i=i||{};if(g.VALIDATE(e,r)){return{}}if(e.application_api_key&&e.application_uid&&i.uid){var s=t.Base+t.upload+i.uid;s=p(s);return w(s,e,n,r)}else if(typeof r=="function"){r({error_message:"provide all parameters"})}return this},save:function(e,n,r,i){i=i||{};if(g.VALIDATE(e,r)){return{}}if(e.application_api_key&&e.application_uid&&i.uid){var s=t.Base+t.upload+i.uid;s=p(s);return y(s,e,n,r)}else if(typeof r=="function"){r({error_message:"provide all parameters"})}return this}},NOTIFICATION:{send:function(e,n,r){if(g.VALIDATE(e,r)){return{}}if(e.application_api_key&&e.application_uid){var i=t.Base+t.notification;i=p(i);return y(i,e,n,r)}else if(typeof r=="function"){r({error_message:"provide all parameters"})}}}};var y=function(e,t,n,r){return s(e,t,n,"POST",r)};var b=function(e,t,n,r){return s(e,t,n,"GET",r)};var w=function(e,t,n,r){return s(e,t,n,"DELETE",r)};var E=function(e,t,n,r){return s(e,t,n,"PUT",r)};var S=function(n,r,i,s,o){r=r||{};if(t.host==""||typeof t.host!=="string"||t.host.length<=0){throw new Error("set host for built.io server. eg: Built.setURL('api.built.io')");return}if(typeof o!="function"){o=function(){}}try{s=s.toUpperCase()}catch(u){}i=i||{};if(typeof XDomainRequest!=="undefined"){return x(n,r,i,s,o)}try{var f=new XMLHttpRequest;if(s!="POST"){i["_method"]=s;s="POST"}f.open(s,n,true);f.setRequestHeader("Content-Type","application/json");if(e.Util.dataType(r)=="object"){for(var l in r){f.setRequestHeader(l,r[l])}}i=JSON.stringify(i);f.onreadystatechange=function(t){if(f.readyState==4){if(f.status!=0){o(f.responseText,f)}else if(f["__aborted__"]==false&&c){try{i=JSON.parse(i)}catch(t){}var s=i["_method"];try{delete i._method}catch(t){}a=true;x(n,r,i,s,o)}else if(f["__aborted__"]){var u={error_message:"request aborted",http:f};o(u,f)}e.Events.trigger("http:end")}};f.ontimeout=f.onerror=function(t){e.Events.trigger("http:end");var n={error_message:"http client error",http:f,event:t};o(n,f);o=function(){}};f.__aborted__=false;f.send(i);e.Events.trigger("http:start");return{_XHR:true,abort:function(){e.Events.trigger("http:end");f.__aborted__=true;f.abort()}}}catch(u){a=true;return x(n,r,i,s,o)}};var x=function(t,n,r,i,s){n=n||{};if(typeof n.application_api_key!=="string"||typeof n.application_uid!=="string"){throw new Error("First initialize built sdk with your application key, eg: Built.initialize('your_application_api_key', 'your_application_uid')")}try{r=JSON.parse(r)}catch(o){}try{delete r._method}catch(o){}var u=h().toString();if(typeof e.cbTray!="object"){e.cbTray={}}e.cbTray[u]=s;var a=T(t,n,r,i,u);var f=N(t,n,r,i,u);f.submit();e.Events.trigger("http:start");return function(t){return{_XHR:false,abort:function(){if(typeof e.cbTray[t]==="function"){e.Events.trigger("http:end");e.cbTray[t]=function(){try{delete e.cbTray[t]}catch(n){}};try{var n=document.getElementById("frame_"+t);n.parentNode.removeChild(n)}catch(r){}try{var i=document.getElementById("form_"+t);i.parentNode.removeChild(i)}catch(r){}}}}}(u)};var T=function(e,n,r,i,s){if(t.host==""||typeof t.host!=="string"||t.host.length<=0){throw new Error("set host for built.io server. eg: Built.setURL('built.io')");return}try{i=i.toUpperCase()}catch(o){i="POST"}var u=C("frame_"+s);u.setAttribute("width","0");u.setAttribute("height","0");u.setAttribute("style","display:none");document.body.appendChild(u);return u};var N=function(e,n,r,i,s){if(t.host==""||typeof t.host!=="string"||t.host.length<=0){throw new Error("set host for built.io server. eg: Built.setURL('built.io')");return}try{i=i.toUpperCase()}catch(o){i="POST"}var u=document.createElement("form");u.setAttribute("id","form_"+s);u.setAttribute("target","frame_"+s);u.setAttribute("method","post");if(e.charAt(e.length-1)=="/"){e=e.substring(0,e.length-1)}e=e+".postmessage";u.setAttribute("action",e);for(var a in n){try{u.appendChild(k(a.toString().toUpperCase(),n[a]))}catch(o){}}r=r||{};var f=typeof r=="object"?JSON.stringify(r):r;u.appendChild(k("PARAM",f));u.appendChild(k("postmessage_payload",s));u.appendChild(k("_method",i));u.appendChild(k("host",document.location.origin?document.location.origin:document.location.protocol+"//"+document.location.host));document.body.appendChild(u);return u};var C=function(e){var t;try{t=document.createElement('<iframe name="'+e+'" id="'+e+'" />')}catch(n){t=document.createElement("iframe");t.id=e;t.name=e}return t};var k=function(e,t){var n;try{n=document.createElement('<input type="hidden" name="'+e+'" />')}catch(r){n=document.createElement("input");n.type="hidden";n.name=e}n.value=t;return n};var L=function(){var t=function(t){var n=t.data?t.data:t.message;try{n=JSON.parse(n)}catch(t){}if(typeof n=="object"&&n.postmessage_payload){var r=n.postmessage_payload;try{delete n["postmessage_payload"]}catch(t){}e.Events.trigger("http:end");if(typeof e.cbTray[r]=="function"){e.cbTray[r](n,{type:"NETWORK"});try{delete e.cbTray[r]}catch(t){}try{var i=document.getElementById("frame_"+r);i.parentNode.removeChild(i)}catch(t){}try{var s=document.getElementById("form_"+r);s.parentNode.removeChild(s)}catch(t){}}else{}}else{}};if(typeof window.addEventListener!=="undefined"){window.addEventListener("message",t,false)}else{window.attachEvent("onmessage",t)}};if(!isNode){L()}var A=function(n,r,i,s,u){r=r||{};if(t.host==""||typeof t.host!=="string"||t.host.length<=0){throw new Error("set host for built.io server. eg: Built.setURL('built.io')");return}try{s=s.toUpperCase()}catch(a){}i=i||{};if(d(l)==false){var f=e.Util.param(l);n+="?"+f}if(s!="POST"){i["_method"]=s;s="POST"}r["Content-Type"]="application/json";return o.post({url:n,headers:r,body:i,json:true,strictSSL:false},function(t,n,r){e.Events.trigger("http:end");if(t){return u(t,n)}return u(r,n)});e.Events.trigger("http:start")};if(isNode){s=A}else{s=S}var O={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(e){var t,n,r,i,s,o,u,a="",f=0;for(e=O._utf8_encode(e);e.length>f;)t=e.charCodeAt(f++),n=e.charCodeAt(f++),r=e.charCodeAt(f++),i=t>>2,s=(3&t)<<4|n>>4,o=(15&n)<<2|r>>6,u=63&r,isNaN(n)?o=u=64:isNaN(r)&&(u=64),a=a+this._keyStr.charAt(i)+this._keyStr.charAt(s)+this._keyStr.charAt(o)+this._keyStr.charAt(u);return a},decode:function(e){var t,n,r,i,s,o,u,a="",f=0;for(e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");e.length>f;)i=this._keyStr.indexOf(e.charAt(f++)),s=this._keyStr.indexOf(e.charAt(f++)),o=this._keyStr.indexOf(e.charAt(f++)),u=this._keyStr.indexOf(e.charAt(f++)),t=i<<2|s>>4,n=(15&s)<<4|o>>2,r=(3&o)<<6|u,a+=String.fromCharCode(t),64!=o&&(a+=String.fromCharCode(n)),64!=u&&(a+=String.fromCharCode(r));return a=O._utf8_decode(a)},_utf8_encode:function(e){e=e.replace(/\r\n/g,"\n");for(var t="",n=0;e.length>n;n++){var r=e.charCodeAt(n);128>r?t+=String.fromCharCode(r):r>127&&2048>r?(t+=String.fromCharCode(192|r>>6),t+=String.fromCharCode(128|63&r)):(t+=String.fromCharCode(224|r>>12),t+=String.fromCharCode(128|63&r>>6),t+=String.fromCharCode(128|63&r))}return t},_utf8_decode:function(e){for(var t="",n=0,r=c1=c2=0;e.length>n;)r=e.charCodeAt(n),128>r?(t+=String.fromCharCode(r),n++):r>191&&224>r?(c2=e.charCodeAt(n+1),t+=String.fromCharCode((31&r)<<6|63&c2),n+=2):(c2=e.charCodeAt(n+1),c3=e.charCodeAt(n+2),t+=String.fromCharCode((15&r)<<12|(63&c2)<<6|63&c3),n+=3);return t}};var M={get:function(e){if(typeof localStorage!=="undefined"){return localStorage.getItem(e)||null}return null},set:function(e,t){if(typeof localStorage!=="undefined"&&e){return localStorage.setItem(e,t)}return null}}}var isNode=typeof exports!=="undefined"&&typeof module!=="undefined"&&typeof module.exports!=="undefined"?true:false;var scope=typeof window==="undefined"?this:window;var methods=new Built;for(var i in methods){Built[i]=methods[i]}if(isNode){module.exports=Built}else{scope.Built=Built}if(typeof define==="function"&&define.amd){define("Built",function(){return Built})}